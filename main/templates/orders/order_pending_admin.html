{% load static %}
{% load humanize %}

<style>
    /* استایل‌های پایه و ریست */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    :root {
        --primary-color: #4CAF50;
        --primary-dark: #2E7D32;
        --primary-light: #C8E6C9;
        --primary-bg: #E8F5E9;
        --secondary-color: #2196F3;
        --secondary-dark: #0D47A1;
        --text-dark: #263238;
        --text-light: #78909C;
        --success-color: #4CAF50;
        --info-color: #2196F3;
        --warning-color: #FF9800;
        --error-color: #f44336;
        --bg-light: #f8f9fa;
        --white: #ffffff;
        --border-radius: 12px;
        --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
    }
    
    body {
        font-family: 'Yekan', 'Segoe UI', Tahoma, sans-serif;
        background-color: var(--bg-light);
        color: var(--text-dark);
        line-height: 1.6;
        padding: 0;
        margin: 0;
        direction: rtl;
    }
    
    .payment-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
    }
    
    .payment-card {
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--box-shadow);
        background: var(--white);
        transition: var(--transition);
    }
    
    .payment-card:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
    }
    
    /* هدر پرداخت */
    .payment-header {
        padding: 1.75rem 2rem;
        color: var(--white);
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        position: relative;
        overflow: hidden;
    }
    
    .payment-header::before {
        content: '';
        position: absolute;
        top: -20px;
        left: -20px;
        width: 120px;
        height: 120px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }
    
    .payment-header::after {
        content: '';
        position: absolute;
        bottom: -30px;
        right: -30px;
        width: 160px;
        height: 160px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 50%;
    }
    
    .payment-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 2;
    }
    
    .payment-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        position: relative;
        z-index: 2;
    }
    
    /* بخش بدنه */
    .payment-body {
        padding: 2.5rem 2rem;
    }
    
    .payment-section {
        margin-bottom: 2.5rem;
    }
    
    .payment-section:last-child {
        margin-bottom: 0;
    }
    
    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--primary-light);
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-left: 0.5rem;
        font-size: 1.4rem;
    }
    
    /* بخش اطلاع‌رسانی */
    .alert {
        border-radius: 10px;
        padding: 1.25rem 1.5rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
        border-right: 4px solid transparent;
    }
    
    .alert i {
        font-size: 1.5rem;
        margin-left: 0.75rem;
        flex-shrink: 0;
    }
    
    .alert-content {
        flex: 1;
    }
    
    .alert-success {
        background-color: rgba(76, 175, 80, 0.1);
        border-color: var(--success-color);
        color: var(--success-color);
    }
    
    .alert-info {
        background-color: rgba(33, 150, 243, 0.1);
        border-color: var(--info-color);
        color: var(--info-color);
    }
    
    .alert h5 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    /* کارت بانکی */
    .bank-card {
        background: linear-gradient(135deg, var(--secondary-color) 0%, var(--secondary-dark) 100%);
        color: var(--white);
        border-radius: 12px;
        padding: 1.75rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
    }
    
    .bank-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }
    
    .bank-card::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }
    
    .bank-card-title {
        font-size: 0.95rem;
        margin-bottom: 0.5rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
    }
    
    .bank-card-title i {
        margin-left: 0.5rem;
        font-size: 1.1rem;
    }
    
    .bank-card-number-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        gap: 1rem;
    }
    
    .bank-card-number {
        font-size: 1.5rem;
        font-weight: 600;
        direction: ltr;
        unicode-bidi: bidi-override;
        text-align: right;
        letter-spacing: 2px;
        flex: 1;
        font-family: 'Courier New', monospace;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 6px;
    }
    
    .bank-card-details {
        display: flex;
        justify-content: space-between;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .bank-card-detail-item {
        flex: 1;
    }
    
    .bank-card-sheba {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .bank-card-sheba-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 0.5rem;
    }
    
    .bank-card-sheba-number {
        font-family: 'Courier New', monospace;
        font-size: 1.1rem;
        font-weight: 600;
        letter-spacing: 1px;
        direction: ltr;
        text-align: left;
        flex: 1;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 6px;
    }
    
    /* دکمه‌ها */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.85rem 1.75rem;
        border-radius: 8px;
        font-weight: 500;
        text-align: center;
        text-decoration: none;
        transition: var(--transition);
        border: none;
        cursor: pointer;
        font-size: 1rem;
        gap: 0.5rem;
    }
    
    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }
    
    .btn-success {
        background-color: var(--success-color);
        color: var(--white);
    }
    
    .btn-success:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    
    .btn-outline-success {
        background-color: transparent;
        color: var(--success-color);
        border: 1px solid var(--success-color);
    }
    
    .btn-outline-success:hover {
        background-color: var(--success-color);
        color: var(--white);
    }
    
    .btn-whatsapp {
        background-color: #25D366;
        color: var(--white);
    }
    
    .btn-whatsapp:hover {
        background-color: #128C7E;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
    }
    
    .btn-telegram {
        background-color: #0088cc;
        color: var(--white);
    }
    
    .btn-telegram:hover {
        background-color: #005580;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
    }
    
    .btn-group {
        display: flex;
        gap: 0.75rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }
    
    .copy-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
        min-width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .copy-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
    }
    
    .copy-btn:active {
        transform: translateY(0);
    }
    
    .copy-btn.copied {
        background: rgba(76, 175, 80, 0.8);
        border-color: rgba(76, 175, 80, 1);
    }
    
    /* بخش اطلاعات تماس */
    .contact-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .contact-details {
        flex: 1;
    }
    
    .contact-details p {
        margin-bottom: 0.5rem;
    }
    
    /* رسپانسیو */
    @media (max-width: 768px) {
        .payment-header {
            padding: 1.5rem 1.25rem;
        }
        
        .payment-title {
            font-size: 1.5rem;
        }
        
        .payment-body {
            padding: 1.75rem 1.25rem;
        }
        
        .bank-card-number {
            font-size: 1.2rem;
        }
        
        .bank-card-details {
            flex-direction: column;
            gap: 1rem;
        }
        
        .btn-group {
            flex-direction: column;
        }
        
        .contact-info {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .bank-card-number-container,
        .bank-card-sheba-container {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .copy-btn {
            align-self: stretch;
        }
    }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<script>
function copyToClipboard(elementId, type) {
    const element = document.getElementById(elementId);
    const text = element.textContent.trim();
    
    // حذف فاصله‌ها برای کپی کردن
    const cleanText = text.replace(/\s/g, '');
    
    navigator.clipboard.writeText(cleanText).then(function() {
        // نمایش پیام موفقیت
        showCopySuccess(elementId, type);
    }).catch(function(err) {
        console.error('خطا در کپی کردن: ', err);
        // روش جایگزین برای مرورگرهای قدیمی
        fallbackCopyTextToClipboard(cleanText, elementId, type);
    });
}

function fallbackCopyTextToClipboard(text, elementId, type) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        const successful = document.execCommand('copy');
        if (successful) {
            showCopySuccess(elementId, type);
        } else {
            showCopyError(type);
        }
    } catch (err) {
        console.error('خطا در کپی کردن: ', err);
        showCopyError(type);
    }
    
    document.body.removeChild(textArea);
}

function showCopySuccess(elementId, type) {
    const button = document.querySelector(`#${elementId}`).nextElementSibling;
    const originalHtml = button.innerHTML;
    
    // تغییر آیکون به تیک
    button.innerHTML = '<i class="fas fa-check"></i>';
    button.classList.add('copied');
    
    // نمایش پیام موفقیت
    const toast = document.createElement('div');
    toast.className = 'copy-toast';
    toast.innerHTML = `<i class="fas fa-check-circle"></i> ${type} با موفقیت کپی شد!`;
    document.body.appendChild(toast);
    
    // حذف پیام بعد از 3 ثانیه
    setTimeout(() => {
        toast.classList.add('fade-out');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 2700);
    
    // بازگرداندن دکمه به حالت اولیه بعد از 2 ثانیه
    setTimeout(() => {
        button.innerHTML = originalHtml;
        button.classList.remove('copied');
    }, 2000);
}

function showCopyError(type) {
    const toast = document.createElement('div');
    toast.className = 'copy-toast error';
    toast.innerHTML = `<i class="fas fa-exclamation-circle"></i> خطا در کپی کردن ${type}`;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('fade-out');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 2700);
}

// اضافه کردن انیمیشن برای اسکرول نرم
document.addEventListener('DOMContentLoaded', function() {
    const bankCard = document.querySelector('.bank-card');
    if (bankCard) {
        setTimeout(() => {
            bankCard.style.transform = 'translateY(0)';
            bankCard.style.opacity = '1';
        }, 300);
    }
});
</script>

<style>
.copy-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--success-color);
    color: var(--white);
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    z-index: 10000;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    max-width: 320px;
}

.copy-toast.error {
    background: var(--error-color);
}

.copy-toast.fade-out {
    animation: fadeOutRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes fadeOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

/* انیمیشن برای ظاهر شدن تدریجی */
.payment-card {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.bank-card {
    opacity: 0;
    transform: translateY(20px);
    transition: transform 0.5s ease, opacity 0.5s ease, box-shadow 0.3s ease;
}
</style>

<div class="payment-container">
    <div class="payment-card">
        <div class="payment-header">
            <div>
                <h1 class="payment-title"><i class="fas fa-credit-card"></i> پرداخت و ارسال رسید</h1>
                <p class="payment-subtitle">لطفا مبلغ را واریز کرده و رسید پرداخت را ارسال نمایید</p>
            </div>
        </div>
        
        <div class="payment-body">
            <!-- اطلاعات پرداخت -->
            <div class="payment-section">
                <h3 class="section-title"><i class="fas fa-info-circle"></i> اطلاعات پرداخت</h3>
                
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <div class="alert-content">
                        <h5>مبلغ قابل پرداخت: {{ order.total_price|intcomma }} تومان</h5>
                        <p>لطفا دقیقا همین مبلغ را به شماره کارت زیر واریز نمایید.</p>
                    </div>
                </div>
                
                <div class="bank-card">
                    <div class="bank-card-title"><i class="fas fa-credit-card"></i> شماره کارت مقصد</div>
                    <div class="bank-card-number-container">
                        <div class="bank-card-number" id="card-number">{{cart_number.number}}</div>
                        <button class="copy-btn" onclick="copyToClipboard('card-number', 'شماره کارت')" title="کپی شماره کارت">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="bank-card-details">
                        <div class="bank-card-detail-item">
                            <div class="bank-card-title"><i class="fas fa-user"></i> به نام</div>
                            <div>{{cart_number.cart_name}}</div>
                        </div>
                        <div class="bank-card-detail-item">
                            <div class="bank-card-title"><i class="fas fa-university"></i> بانک</div>
                            <div>{{cart_number.bank_name}}</div>
                        </div>
                    </div>
                    {% if cart_number.sheba_number %}
                    <div class="bank-card-sheba">
                        <div class="bank-card-title"><i class="fas fa-exchange-alt"></i> شماره شبا</div>
                        <div class="bank-card-sheba-container">
                            <div class="bank-card-sheba-number" id="sheba-number">{{ cart_number.get_formatted_sheba }}</div>
                            <button class="copy-btn" onclick="copyToClipboard('sheba-number', 'شماره شبا')" title="کپی شماره شبا">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- ارسال رسید -->
            <div class="payment-section">
                <h3 class="section-title"><i class="fas fa-paper-plane"></i> ارسال رسید پرداخت</h3>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div class="alert-content">
                        <p>پس از واریز مبلغ، لطفا تصویر رسید پرداخت را از طریق واتساپ ارسال نمایید:</p>
                        
                        <div class="btn-group">
                            <a href="{{ company_info.whatsapp_link }}" class="btn btn-whatsapp">
                                <i class="fab fa-whatsapp"></i> ارسال از طریق واتساپ
                            </a>
                            {% if company_info.telegram_link %}
                            <a href="{{ company_info.telegram_link }}" class="btn btn-telegram">
                                <i class="fab fa-telegram"></i> ارسال از طریق تلگرام
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- اطلاعات تماس -->
            <div class="payment-section">
                <h3 class="section-title"><i class="fas fa-headset"></i> اطلاعات تماس پشتیبانی</h3>
                
                <div class="alert alert-info">
                    <i class="fas fa-question-circle"></i>
                    <div class="alert-content">
                        <p>در صورت بروز هرگونه مشکل می‌توانید با پشتیبانی تماس بگیرید:</p>
                        
                        <div class="contact-info">
                            <div class="contact-details">
                                <p><strong><i class="fas fa-phone"></i> شماره تماس:</strong> {{company_info.contact_phone}}</p>
                                <p><strong><i class="fas fa-clock"></i> ساعات پاسخگویی:</strong> ۹ صبح تا ۵ بعدازظهر</p>
                            </div>
                            
                            <div class="btn-group">
                                <a href="tel:{{company_info.contact_phone}}" class="btn btn-success">
                                    <i class="fas fa-phone"></i> تماس
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>